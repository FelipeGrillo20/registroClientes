<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cuadro de Mando - EstadÃ­sticas</title>
  <link rel="stylesheet" href="css/dashboard-stats.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  
  <!-- Elemento oculto para auth-check.js -->
  <div id="userInfo" style="display: none;"></div>
  
  <div class="stats-container">
    <!-- Header -->
    <div class="stats-header">
      <button class="btn-back" id="btnBack">
        â† Volver a Perfil
      </button>
      <div class="header-content">
        <h1 class="stats-title">
          <span class="title-icon">ğŸ“Š</span>
          Cuadro de Mando Administrativo
        </h1>
        <p class="stats-subtitle">OrientaciÃ³n PsicolÃ³gica - AnÃ¡lisis y EstadÃ­sticas</p>
      </div>
    </div>

    <!-- Controles de Filtros -->
    <div class="filters-section">
      <div class="filter-group">
        <label for="filterMonth">
          <span class="filter-icon">ğŸ“…</span>
          Periodo:
        </label>
        <select id="filterMonth" class="filter-select">
          <option value="current">Mes Actual</option>
          <option value="last">Mes Anterior</option>
          <option value="last3">Ãšltimos 3 Meses</option>
          <option value="last6">Ãšltimos 6 Meses</option>
          <option value="year">AÃ±o Completo</option>
          <option value="custom">Personalizado</option>
        </select>
      </div>

      <div class="filter-group" id="customDateGroup" style="display: none;">
        <label for="startDate">Desde:</label>
        <input type="date" id="startDate" class="filter-input">
        <label for="endDate">Hasta:</label>
        <input type="date" id="endDate" class="filter-input">
      </div>

      <div class="filter-group">
        <label for="filterProfesional">
          <span class="filter-icon">ğŸ‘¤</span>
          Profesional:
        </label>
        <select id="filterProfesional" class="filter-select">
          <option value="all">Todos los Profesionales</option>
          <!-- Se llena dinÃ¡micamente -->
        </select>
      </div>

      <button class="btn-apply-filters" id="btnApplyFilters">
        Aplicar Filtros
      </button>

      <button class="btn-export" id="btnExport">
        ğŸ“¥ Exportar PDF
      </button>
    </div>

    <!-- Loading -->
    <div id="loadingStats" class="loading-overlay" style="display: none;">
      <div class="spinner-large"></div>
      <p>Cargando estadÃ­sticas...</p>
    </div>

    <!-- Tarjetas de Resumen General -->
    <div class="summary-cards">
      <div class="summary-card card-blue">
        <div class="card-icon">ğŸ‘¥</div>
        <div class="card-content">
          <h3 class="card-title">Total Trabajadores</h3>
          <p class="card-value" id="totalWorkers">0</p>
          <p class="card-subtitle" id="workersChange">+0 este mes</p>
        </div>
      </div>

      <div class="summary-card card-green">
        <div class="card-icon">ğŸ“‹</div>
        <div class="card-content">
          <h3 class="card-title">Total Consultas</h3>
          <p class="card-value" id="totalConsultas">0</p>
          <p class="card-subtitle" id="consultasChange">+0 este mes</p>
        </div>
      </div>

      <div class="summary-card card-orange">
        <div class="card-icon">ğŸ”„</div>
        <div class="card-content">
          <h3 class="card-title">Total Sesiones</h3>
          <p class="card-value" id="totalSesiones">0</p>
          <p class="card-subtitle" id="sesionesChange">+0 este mes</p>
        </div>
      </div>

      <div class="summary-card card-teal">
        <div class="card-icon">â±ï¸</div>
        <div class="card-content">
          <h3 class="card-title">Horas de AtenciÃ³n</h3>
          <p class="card-value" id="totalHours">0h</p>
          <p class="card-subtitle" id="hoursChange">+0h este mes</p>
        </div>
      </div>

      <div class="summary-card card-purple">
        <div class="card-icon">âœ…</div>
        <div class="card-content">
          <h3 class="card-title">Casos Cerrados</h3>
          <p class="card-value" id="casosCerradosPercent">0%</p>
          <p class="card-subtitle" id="casosCerradosChange">+0% vs mes ant.</p>
        </div>
      </div>
    </div>

    <!-- GrÃ¡ficos Principales -->
    <div class="charts-grid">
      <!-- Consultas por Profesional -->
      <div class="chart-container">
        <h3 class="chart-title">
          <span class="chart-icon">ğŸ‘¨â€âš•ï¸</span>
          Consultas por Profesional
        </h3>
        <div class="chart-wrapper">
          <canvas id="chartProfesionales"></canvas>
        </div>
      </div>

      <!-- Modalidad de AtenciÃ³n -->
      <div class="chart-container">
        <h3 class="chart-title">
          <span class="chart-icon">ğŸ’»</span>
          Modalidad de AtenciÃ³n
        </h3>
        <div class="chart-wrapper">
          <canvas id="chartModalidad"></canvas>
        </div>
        <div class="chart-data-summary" id="modalidadData">
          <!-- Se llena dinÃ¡micamente -->
        </div>
      </div>

      <!-- Estado de Casos -->
      <div class="chart-container">
        <h3 class="chart-title">
          <span class="chart-icon">ğŸ“Š</span>
          Estado de Casos
        </h3>
        <div class="chart-wrapper">
          <canvas id="chartEstados"></canvas>
        </div>
        <div class="chart-data-summary" id="estadosData">
          <!-- Se llena dinÃ¡micamente -->
        </div>
      </div>
    </div>

    <!-- Segunda fila: Motivos y EvoluciÃ³n -->
    <div class="charts-row-2">
      <!-- Top Motivos de Consulta -->
      <div class="chart-container">
        <h3 class="chart-title">
          <span class="chart-icon">ğŸ“</span>
          Top 5 Motivos de Consulta
        </h3>
        <div class="chart-wrapper">
          <canvas id="chartMotivos"></canvas>
        </div>
      </div>

      <!-- EvoluciÃ³n Mensual -->
      <div class="chart-container">
        <h3 class="chart-title">
          <span class="chart-icon">ğŸ“ˆ</span>
          EvoluciÃ³n de Consultas (Ãšltimos 6 Meses)
        </h3>
        <div class="chart-wrapper">
          <canvas id="chartEvolucion"></canvas>
        </div>
      </div>
    </div>

    <!-- DistribuciÃ³n por Sede y Empresa -->
    <div class="distribution-grid">
      <div class="chart-container">
        <h3 class="chart-title">
          <span class="chart-icon">ğŸ¢</span>
          DistribuciÃ³n por Sede
        </h3>
        <div class="chart-wrapper">
          <canvas id="chartSedes"></canvas>
        </div>
      </div>

      <div class="chart-container">
        <h3 class="chart-title">
          <span class="chart-icon">ğŸ­</span>
          DistribuciÃ³n por Empresa
        </h3>
        <div class="chart-wrapper">
          <canvas id="chartEmpresas"></canvas>
        </div>
      </div>
    </div>

    <!-- Tabla Detallada de Profesionales -->
    <div class="table-section">
      <h3 class="section-title">
        <span class="section-icon">ğŸ“‹</span>
        Detalle por Profesional
      </h3>
      
      <div class="table-container">
        <table class="stats-table" id="tableProfesionales">
          <thead>
            <tr>
              <th>Profesional</th>
              <th>Trabajadores</th>
              <th>Consultas</th>
              <th>Sesiones</th>
              <th>Virtual</th>
              <th>Presencial</th>
              <th>Abiertos</th>
              <th>Cerrados</th>
              <th>Horas</th>
              <th>Promedio Sesiones</th>
            </tr>
          </thead>
          <tbody id="tableProfesionalesBody">
            <!-- Se llena dinÃ¡micamente -->
          </tbody>
          <tfoot id="tableProfesionalesFooter">
            <!-- Totales -->
          </tfoot>
        </table>
      </div>
    </div>

    <!-- Indicadores de Calidad -->
    <div class="quality-section">
      <h3 class="section-title">
        <span class="section-icon">â­</span>
        Indicadores de Calidad y Seguimiento
      </h3>
      
      <div class="quality-grid">
        <div class="quality-card">
          <div class="quality-icon">ğŸ“…</div>
          <div class="quality-content">
            <h4>Tiempo Promedio de AtenciÃ³n</h4>
            <p class="quality-value" id="avgDuration">0 dÃ­as</p>
            <p class="quality-detail">Desde primera hasta Ãºltima sesiÃ³n</p>
          </div>
        </div>

        <div class="quality-card">
          <div class="quality-icon">ğŸ”„</div>
          <div class="quality-content">
            <h4>Sesiones Promedio por Caso</h4>
            <p class="quality-value" id="avgSessions">0</p>
            <p class="quality-detail">Antes de cerrar un caso</p>
          </div>
        </div>

        <div class="quality-card">
          <div class="quality-icon">ğŸ“</div>
          <div class="quality-content">
            <h4>Contacto de Emergencia</h4>
            <p class="quality-value" id="emergencyContact">0%</p>
            <p class="quality-detail">Trabajadores con contacto registrado</p>
          </div>
        </div>

        <div class="quality-card">
          <div class="quality-icon">âš ï¸</div>
          <div class="quality-content">
            <h4>Sin Seguimiento Reciente</h4>
            <p class="quality-value" id="noFollowup">0</p>
            <p class="quality-detail">MÃ¡s de 30 dÃ­as sin consulta</p>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script src="js/config.js"></script>
  <script src="js/auth-check.js"></script>
  <script src="js/dashboard-stats.js"></script>
</body>
</html>