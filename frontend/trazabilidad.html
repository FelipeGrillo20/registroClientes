<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trazabilidad de Pagos</title>
  <link rel="stylesheet" href="css/trazabilidad.css" />
  <script src="js/auth-check.js"></script>
</head>
<body>
  <header class="page-header">
    <div id="userInfo" class="user-info-bar"></div>
    <h1>ğŸ’³ Trazabilidad de Pagos</h1>
    <p class="page-subtitle">AnÃ¡lisis de Entidades Pagadoras</p>
  </header>

  <main class="page-main">
    <!-- Botones de navegaciÃ³n -->
    <div class="navigation-actions">
      <a href="clientes.html" class="btn-nav">â† Clientes Registrados</a>
      <a href="index.html" class="btn-nav">ğŸ“ Registro de Clientes</a>
    </div>

    <!-- Filtros Avanzados para Administrador -->
    <div id="adminFiltersContainer" class="admin-filters-container" style="display: none;">
      <h2 class="filters-title">ğŸ‘¤ Filtros de Administrador</h2>
      
      <div class="admin-filters-grid">
        <div class="filter-group">
          <label for="filterProfesional">Profesional:</label>
          <select id="filterProfesional">
            <option value="">Todos los Profesionales</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="filterMes">Filtrar por Mes:</label>
          <select id="filterMes">
            <option value="">Seleccionar mes...</option>
            <option value="mes_actual">Mes Actual</option>
            <option value="mes_anterior">Mes Anterior</option>
            <option value="ultimos_3_meses">Ãšltimos 3 Meses</option>
            <option value="ultimos_6_meses">Ãšltimos 6 Meses</option>
            <option value="este_aÃ±o">Este AÃ±o</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="filterFechaInicio">Fecha Inicio:</label>
          <input type="date" id="filterFechaInicio" />
        </div>

        <div class="filter-group">
          <label for="filterFechaFin">Fecha Fin:</label>
          <input type="date" id="filterFechaFin" />
        </div>

        <div class="filter-group filter-actions-group">
          <button id="btnApplyAdvancedFilters" class="btn-apply-advanced">
            ğŸ” Aplicar Filtros
          </button>
        </div>

        <div class="filter-group filter-actions-group">
          <button id="btnClearAdvancedFilters" class="btn-clear-advanced">
            ğŸ”„ Limpiar Avanzados
          </button>
        </div>
      </div>
    </div>

    <!-- SecciÃ³n de filtros en cascada -->
    <div class="filters-container">
      <h2 class="filters-title">ğŸ” Filtros de BÃºsqueda</h2>
      
      <div class="filters-grid">
        <div class="filter-group">
          <label for="filterTipoCliente">Tipo de Cliente:</label>
          <select id="filterTipoCliente">
            <option value="">Todos los Tipos</option>
            <option value="Particular">Particular</option>
            <option value="ARL">ARL</option>
            <option value="CCF">CCF</option>
          </select>
        </div>

        <div class="filter-group" id="filterNombreClienteContainer" style="display: none;">
          <label for="filterNombreCliente" id="labelNombreCliente">Seleccione:</label>
          <select id="filterNombreCliente">
            <option value="">Todos</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="filterVinculo">VÃ­nculo:</label>
          <select id="filterVinculo">
            <option value="">Todos los VÃ­nculos</option>
            <option value="Trabajador">Trabajador</option>
            <option value="Familiar Trabajador">Familiar Trabajador</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="filterSede">Sede:</label>
          <select id="filterSede">
            <option value="">Todas las Sedes</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="filterEmpresa">Empresa Usuario:</label>
          <select id="filterEmpresa">
            <option value="">Todas las Empresas</option>
          </select>
        </div>

        <div class="filter-group">
          <label for="filterSubcontratista">Cliente Final:</label>
          <select id="filterSubcontratista">
            <option value="">Todos los Subcontratistas</option>
            <option value="NO_APLICA">Sin Subcontratista</option>
          </select>
        </div>

        <div class="filter-group filter-actions-group">
          <button id="btnClearFilters" class="btn-clear-filters">ğŸ”„ Limpiar Filtros</button>
        </div>
      </div>
    </div>

    <!-- EstadÃ­sticas -->
    <div class="stats-container">
      <div class="stat-card">
        <div class="stat-icon">ğŸ‘¥</div>
        <div class="stat-info">
          <div class="stat-value" id="statTotal">0</div>
          <div class="stat-label">Total Registros</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸŸ¢</div>
        <div class="stat-info">
          <div class="stat-value" id="statParticular">0</div>
          <div class="stat-label">Particular</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ”´</div>
        <div class="stat-info">
          <div class="stat-value" id="statARL">0</div>
          <div class="stat-label">ARL</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸŸ¡</div>
        <div class="stat-info">
          <div class="stat-value" id="statCCF">0</div>
          <div class="stat-label">CCF</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ“‹</div>
        <div class="stat-info">
          <div class="stat-value" id="statSesiones">0</div>
          <div class="stat-label">Total Sesiones</div>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">â±ï¸</div>
        <div class="stat-info">
          <div class="stat-value" id="statHoras">0</div>
          <div class="stat-label">Horas Atendidas</div>
        </div>
      </div>
    </div>

    <!-- Tabla de resultados -->
    <div class="table-container">
      <table class="trazabilidad-table" id="trazabilidadTable">
        <thead>
          <tr>
            <!-- Columnas de la sesiÃ³n (vienen de la tabla consultas) -->
            <th>Fecha Consulta</th>
            <!-- Columnas del cliente (existentes) -->
            <th>Tipo Cliente</th>
            <th>Nombre Cliente</th>
            <th>Empresa Usuario</th>
            <th>Cliente Final</th>
            <th>VÃ­nculo</th>
            <th>Sede</th>
            <th>Nombre</th>
            <th>CÃ©dula</th>
            <!-- Columnas nuevas de la sesiÃ³n -->
            <th>Motivo Consulta</th>
            <th>SesiÃ³n #</th>
            <th>Horas SesiÃ³n</th>
            <th>Sesiones Sugeridas</th>
            <th>Observaciones</th>
            <th>Profesional</th>
          </tr>
        </thead>
        <tbody id="trazabilidadList">
          <!-- Filas generadas dinÃ¡micamente -->
        </tbody>
      </table>
    </div>

    <!-- BotÃ³n Exportar Excel -->
    <div class="export-actions-container">
      <button id="btnExportarExcel" class="btn-exportar-excel" onclick="exportarExcel()">
        ğŸ“Š Exportar Registros
      </button>
    </div>

    <!-- Mensaje sin datos -->
    <div id="noDataMessage" class="no-data-message" style="display: none;">
      <div class="no-data-icon">ğŸ“Š</div>
      <p>No se encontraron registros con los filtros seleccionados</p>
    </div>
  </main>

  <!-- SheetJS para exportar Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="js/config.js"></script>
  <script src="js/auth-check.js"></script>
  <script src="js/trazabilidad.js"></script>
</body>
</html>